<div class="space-y-6 relative pb-20">
  <!-- Section Header -->
  <div class="flex justify-between items-center" [@fadeIn]>
    <div>
      <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
        <mat-icon class="text-blue-600">assignment</mat-icon>
        Tasks
      </h2>
      <p class="text-sm text-gray-500 mt-1">
        {{ tasks.length }} task{{ tasks.length !== 1 ? 's' : '' }}
        <span *ngIf="tasks.length > 0">
          â€¢ {{ getCompletedCount() }} completed
        </span>
      </p>
    </div>

    <!-- Filter Options -->
    <mat-chip-set aria-label="Filter tasks" class="hidden md:flex">
      <mat-chip (click)="filterTasks('all')" [highlighted]="currentFilter === 'all'">
        All
      </mat-chip>
      <mat-chip (click)="filterTasks('active')" [highlighted]="currentFilter === 'active'">
        Active
      </mat-chip>
      <mat-chip (click)="filterTasks('completed')" [highlighted]="currentFilter === 'completed'">
        Completed
      </mat-chip>
    </mat-chip-set>
  </div>

  <!-- Loading Skeleton -->
  <div *ngIf="isLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
    <mat-card *ngFor="let item of [1,2,3,4]" class="!shadow-md">
      <mat-card-content class="p-4">
        <div class="animate-pulse space-y-2">
          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          <div class="h-3 bg-gray-200 rounded w-full"></div>
          <div class="h-3 bg-gray-200 rounded w-5/6"></div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Task Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" *ngIf="!isLoading"
    [@listAnimation]="filteredTasks.length">
    <mat-card *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
      class="!shadow-md hover:!shadow-xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1 cursor-pointer"
      [class.opacity-50]="isTaskDeleting(task.id)" (click)="openTaskDetailsDialog(task)" [@cardHover]>

      <!-- Status Color Bar -->
      <div class="h-1-mx-4 mb-3" [ngClass]="{
        'bg-gradient-to-r from-gray-300 to-gray-400': task.status === statusEnum.Todo,
        'bg-gradient-to-r from-blue-400 to-blue-600': task.status === statusEnum.InProgress,
        'bg-gradient-to-r from-green-400 to-green-600': task.status === statusEnum.Done
      }"></div>

      <mat-card-content class="p-4">
        <div class="flex flex-col gap-3">

          <!-- Task Header -->
          <div class="flex items-start justify-between gap-2">
            <!-- Status Icon -->
            <div class="p-1.5 rounded-lg transition-all duration-300 flex-shrink-0" [ngClass]="{
              'bg-gray-100': task.status === statusEnum.Todo,
              'bg-blue-100': task.status === statusEnum.InProgress,
              'bg-green-100': task.status === statusEnum.Done
            }">
              <mat-icon class="!text-[20px] !w-5 !h-5 !leading-5 transition-all duration-300" [ngClass]="{
  'text-gray-500': task.status === statusEnum.Todo,
  'text-blue-600': task.status === statusEnum.InProgress,
  'text-green-600': task.status === statusEnum.Done
}">
                {{ task.status === statusEnum.Done ? 'check_circle' :
                task.status === statusEnum.InProgress ? 'pending' : 'radio_button_unchecked' }}
              </mat-icon>
            </div>

            <!-- Delete Button -->
            <button mat-icon-button color="warn" (click)="deleteTask(projectId, task.id, $event)"
              [disabled]="isTaskDeleting(task.id)" class="!w-8 !h-8 !p-0 flex-shrink-0" matTooltip="Delete task">
              <mat-icon class="!text-lg" *ngIf="!isTaskDeleting(task.id)">delete_outline</mat-icon>
              <mat-progress-spinner *ngIf="isTaskDeleting(task.id)" diameter="20" mode="indeterminate">
              </mat-progress-spinner>
            </button>
          </div>

          <!-- Task Info -->
          <div class="flex-1 min-w-0">
            <!-- Task Title -->
            <h3 class="text-base font-semibold text-gray-800 mb-1.5 transition-all duration-300 line-clamp-2">
              {{ task.title }}
            </h3>

            <!-- Task Description -->
            <p class="text-xs text-gray-600 leading-relaxed line-clamp-2 mb-2">
              {{ task.description || 'No description provided' }}
            </p>

            <!-- Task Metadata -->
            <div class="flex flex-col gap-1.5 text-xs text-gray-500">
              <span class="flex items-center gap-1">
                <mat-icon class="!text-xs !w-3 !h-3">schedule</mat-icon>
                {{ task.createdAt | date:'MMM d' }}
              </span>

              <!-- Current Assignment Badge -->
              <span *ngIf="task.assignedEmployeeId"
                class="inline-flex items-center gap-1 px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded-full w-fit max-w-full">
                <mat-icon class="!text-xs !w-3 !h-3 flex-shrink-0">person</mat-icon>
                <span class="truncate min-w-0">{{ task.assignedEmployeeName }}</span>
              </span>
              <span *ngIf="!task.assignedEmployeeId"
                class="flex items-center gap-1 px-1.5 py-0.5 bg-gray-50 text-gray-500 rounded-full w-fit">
                <mat-icon class="!text-xs !w-3 !h-3">person_off</mat-icon>
                Unassigned
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Empty State -->
  <mat-card *ngIf="!isLoading && tasks.length === 0" class="!shadow-lg border-2 border-dashed border-gray-300"
    [@fadeIn]>
    <mat-card-content class="text-center py-16">
      <div class="flex flex-col items-center space-y-4">
        <div class="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-full">
          <mat-icon class="!text-[80px] !w-20 !h-20 text-blue-400">assignment</mat-icon>
        </div>
        <h3 class="text-2xl font-bold text-gray-700">No tasks yet</h3>
        <p class="text-gray-500 max-w-md">
          Get started by creating your first task for this project.
        </p>
        <button mat-raised-button color="primary" (click)="openCreateTaskDialog()"
          class="!mt-4 !rounded-lg !px-6 !py-3">
          <mat-icon class="mr-2">add_circle</mat-icon>
          Create Your First Task
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Progress Indicator -->
  <mat-card *ngIf="!isLoading && tasks.length > 0" class="!shadow-md !bg-gradient-to-r !from-blue-50 !to-indigo-50"
    [@fadeIn]>
    <mat-card-content class="p-6">
      <div class="flex items-center justify-between mb-3">
        <span class="text-sm font-semibold text-gray-700">Overall Progress</span>
        <span class="text-sm font-bold text-blue-600">{{ getProgressPercentage() }}%</span>
      </div>
      <mat-progress-bar mode="determinate" [value]="getProgressPercentage()" class="!h-3 !rounded-full">
      </mat-progress-bar>
    </mat-card-content>
  </mat-card>
</div>